# Commvault CommServe QCommand RCE Chain (CVE-2025-57790 & CVE-2025-57791)

> **Author:** Brian Maroney  
> **Date:** 2025-01-08  
> **Status:** experimental  
> **Severity:** Critical  

---

## Purpose
Detect potential exploitation of a critical remote code execution (RCE) chain in **Commvault CommServe**, where argument injection (**CVE-2025-57791**) and path traversal (**CVE-2025-57790**) can be chained to achieve unauthenticated command execution via the `qlogin` method in **QCommands**. Exploitation allows attackers to gain system-level access, issue unauthorized commands, or write malicious files (e.g., JSP web shells) to the server webroot.

---

## Metadata (YAML)
```yaml
title: "Commvault CommServe QCommand RCE Chain (CVE-2025-57790 / CVE-2025-57791)"
id: "commvault-cve-2025-5779x"
cve:
  - CVE-2025-57790
  - CVE-2025-57791
status: experimental
author: "Brian Maroney"
date: "2025-01-08"
tags:
  - cve.2025-57790
  - cve.2025-57791
  - attack.t1190
  - attack.initial_access
  - attack.execution
  - product.commvault.commserve
  - exploit.argument_injection
  - exploit.path_traversal
logsource:
  category: webserver
  product: commvault
level: critical
description: >
  Detects malicious requests to Commvault CommServe APIs that attempt argument injection
  or path traversal in QCommands (notably qlogin), resulting in authentication bypass and
  potential remote code execution. Targets endpoints like /commandcenter/api/Login or
  /commandcenter/publicLink.do.

```
---

## Detection Logic (YAML)
```yaml
detection:
  suspicious_login_requests:
    # Malicious qlogin and Login API exploitation
    http.request_method:
      - POST
    http.url|contains:
      - "/commandcenter/api/Login"
    http.body|re: "(?i)(qlogin|localadmin|qcommand|system|cmd|exec|jsp|/webroot)"
    http.body|re: "(?i)(;|&&|\\|\\||\\$\\(|\\`)"
    http.user_agent|re: "(?i)(curl|python|wget|httpclient|java)"

  hostname_enumeration:
    # reconnaissance via /commandcenter/publicLink.do
    http.request_method:
      - GET
    http.url|contains:
      - "/commandcenter/publicLink.do"
    http.status:
      - 200
    http.user_agent|re: "(?i)(curl|python|wget|httpclient|nmap|masscan)"

  suspicious_file_write:
    # possible JSP or script upload to CommServe webroot
    file.path|re: "(?i)(webapps|webroot|tomcat|jsp|\\.jsp$|/commandcenter/)"
    file.action|contains:
      - "write"
      - "create"
    user.name|re: "(?i)(system|localadmin|svc_|websvc|tomcat)"

  condition: suspicious_login_requests OR (hostname_enumeration AND suspicious_file_write)

```
---

## Splunk Query
```yaml
index=web OR index=proxy sourcetype=commvault:web
| where (uri_path LIKE "%/commandcenter/api/Login%" OR uri_path LIKE "%/commandcenter/publicLink.do%")
| eval body_lower=lower(request_body)
| where match(body_lower,"(qlogin|localadmin|qcommand|cmd|exec|system|jsp|/webroot)")
   OR match(body_lower,"(;|&&|\\|\\||\\$\\(|\\`)")
| table _time src_ip dest_ip uri_path user_agent request_body http_status
| stats count earliest(_time) as first_seen latest(_time) as last_seen values(user_agent) as user_agents by src_ip dest_ip uri_path
| sort - count
