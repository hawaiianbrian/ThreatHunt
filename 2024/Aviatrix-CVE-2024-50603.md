# Aviatrix Controller Remote Code Execution (CVE-2024-50603)  
**Unauthenticated API-based RCE in Aviatrix Controller â€” active exploitation / opportunistic scanning**

**Author:** Brian Maroney  
**Date:** 2025-01-10  
**Status:** experimental  
**Severity:** Critical (CVSS 10.0)

---

## Purpose
Detect exploitation attempts and post-exploitation activity for **CVE-2024-50603**, an unauthenticated remote code execution vulnerability in Aviatrix Controller API. The flaw allows injection of shell metacharacters into API fields (notably `cloud_type` and `src_cloud_type`) that are appended to a CLI invocation, enabling arbitrary command execution. Observed in-the-wild behavior includes deployment of cryptominers (XMRig) and Sliver backdoors.

---

## Metadata (YAML)
```yaml
title: "Aviatrix Controller API Remote Code Execution (CVE-2024-50603)"
id: "aviatrix-cve-2024-50603"
cve: "CVE-2024-50603"
status: "experimental"
description: >
  Detects suspicious Aviatrix Controller API requests with shell metacharacters
  in cloud_type/src_cloud_type or other flightpath parameters, and associated
  post-exploitation indicators (downloads, xmrig, sliver, unexpected python/curl/wget).
author: "Brian Maroney"
date: "2025-01-10"
tags:
  - cve.2024-50603
  - attack.execution
  - attack.initial_access
  - attack.persistence
  - product.aviatrix.controller
  - api
logsource:
  category: api
  product: aviatrix
level: critical

```
---

## Detection Logic (YAML)
```yaml

detection:
  suspicious_api_payloads:
    # identify API calls to flightpath endpoints with field values containing shell metacharacters or command keywords
    http.request_method:
      - POST
    http.url|re: "(?i)/v1/api|/controller/api|/v1/.*flightpath"
    http.body|re: "(?i)(cloud_type|src_cloud_type)\s*[:=]\s*['\"]?.*([;`$()<>\\&\\|\\|\\|]|\\bsh\\b|\\bbash\\b|\\bcurl\\b|\\bwget\\b|\\bpython\\b).+"
    http.header|re: "(?i)(curl|wget|powershell|invoke-webrequest|invoke-expression)"

  cli_injection_artifacts:
    # patterns that indicate shell/command injection or execution
    process.name|re: "(?i)(xmrig|sliver|sliver-client|sliver-server|curl|wget|python|sh)"
    process.command_line|re: "(?i)(curl\\s+http|wget\\s+http|python\\s+-m|/bin/sh\\s+-c|sliver|xmrig)"
    file.path|re: "(?i)(/tmp/|/var/tmp/|/opt/|/usr/local/|/home/.*(/downloads|/tmp)/)"
    network.outbound|re: "(?i)(mining|xmrig|sliver|c2|pool[.]|stratum)"

  sensitive_file_leak:
    # evidence of exfil via API-triggered curl/wget
    http.outbound.request|re: "(?i)(curl.+@/etc/passwd|curl.+@/root/.ssh|wget.+/etc/passwd)"

  correlation_enrichment:
    - cloudtrail_or_cloud_audit_logs
    - unexpected_role_changes
    - new_instance_creation
    - network_allowlist_changes

  exclusions:
    src_ip|in:
      - "10.0.0.0/8"
      - "192.168.0.0/16"
      - "172.16.0.0/12"
    user_agent|contains:
      - "Aviatrix-Internal"
      - "Trusted-Automation"

  condition: suspicious_api_payloads OR cli_injection_artifacts OR sensitive_file_leak

```
---

## Splunk Query
```yaml
index=Index sourcetype=aviatrix:api OR sourcetype=web
| where method="POST"
  AND (
    like(uri_path,"%list_flightpath_destination_instances%")
    OR like(uri_path,"%flightpath_connection_test%")
    OR match(uri_path,"(?i)/v1/api")
  )
| eval body_lower=lower(request_body)
| where match(body_lower, "(cloud_type|src_cloud_type).*(\\||`|\\$\\(|;|\\||\\|\\||>&|\\b(curl|wget|python|sh|bash)\\b)")
| table _time src_ip dest_ip uri_path request_body user_agent
| where NOT cidrmatch("10.0.0.0/8", src_ip)
  AND NOT cidrmatch("192.168.0.0/16", src_ip)
| stats count earliest(_time) as first_seen latest(_time) as last_seen values(user_agent) as user_agents by src_ip dest_ip uri_path
| sort - count
